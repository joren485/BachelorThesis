\chapter{Penetration Testing of Docker}\label{chapter:pentesting}
In \autoref{chapter:vulnerabilities-misconfigurations} we looked at specific attacker models, individual vulnerabilities and individual misconfigurations. In this chapter we will look at how we would use those during a penetration test. We will first look at how to use them manually. After that, we will look at how we can automate the manual steps.

\hfill

We will mostly focus on the misconfigurations, because although the vulnerabilities might have a high impact they are all mitigated with one line of advice: ``Keep your systems up to date''.

\section{Manual}
\todo[inline]{Which attack scenarios from 3 are relevant?}

\subsection{Attack Context Detection}
\todo[inline]{Detect running in a Docker}
\todo[inline]{Detect Docker (running) on host}
\todo[inline]{\href{https://github.com/rapid7/metasploit-framework/blob/master/modules/post/linux/gather/checkcontainer.rb}{Metasploit Linux Gather Container Detection}}

\subsection{Testing from Host}
\todo[inline]{What images are available on the host?}
\todo[inline]{systemctl cat docker}
\todo[inline]{/etc/default/docker}
\todo[inline]{daemon.json}
\todo[inline]{firewall rules}
\todo[inline]{docker binary setuid}
\todo[inline]{check if docker is installed}
\todo[inline]{check docker socket}
\todo[inline]{Which users are in the docker group}
\todo[inline]{Open ports to Docker socket?}
\todo[inline]{What containers are running}
\todo[inline]{Docker version, does not require docker permissions}

\subsection{Testing from Container}
\todo[inline]{\href{https://stackoverflow.com/questions/32144575/how-to-know-if-a-docker-container-is-running-in-privileged-mode}{How to know if a docker container is running in privileged mode}}
\todo[inline]{grep Cap /proc/1/status}
\todo[inline]{capsh --decode=00000000a80425fb}
\todo[inline]{Reachable containers}
\todo[inline]{ARP Spoofing other containers}
\todo[inline]{Privileged capability 0000003fffffffff}
\todo[inline]{find docker socket}
\todo[inline]{Identify host OS and container OS}
\todo[inline]{root in container}

\section{Automated}
\todo[inline]{\href{https://github.com/ProfessionallyEvil/harpoon}{harpoon}}
\todo[inline]{Source \href{https://www.zenko.io/blog/5-free-tools-to-navigate-through-docker-containers-security}{5-free-tools-to-navigate-through-docker-containers-security}}
\todo[inline]{Static analysis tool: \url{https://github.com/coreos/clair}}
\todo[inline]{Scanner for clair: \url{https://github.com/arminc/clair-scanner}}
\todo[inline]{Static vulnerability scanner (and clamAV) on software in container: \url{https://github.com/eliasgranderubio/dagda}}
\todo[inline]{\href{https://github.com/goodwithtech/dockle}{Dockle}}
\todo[inline]{Scanner using the CIS Docker Benchmark: \url{https://github.com/docker/docker-bench-security}}
\todo[inline]{SaaS container policy scanner: \url{https://anchore.com}}
\todo[inline]{Research: Twistlock}
\todo[inline]{Research: Sqreen}
\todo[inline]{sysdig: \url{https://sysdig.com/}}
\todo[inline]{sysdig: \url{https://sysdig.com/opensource/falco/}}
